#!/bin/sh
#============================================================================
#
#     This file is part of the Code_Saturne Kernel, element of the
#     Code_Saturne CFD tool.
#
#     Copyright (C) 1998-2008 EDF S.A., France
#
#     contact: saturne-support@edf.fr
#
#     The Code_Saturne Kernel is free software; you can redistribute it
#     and/or modify it under the terms of the GNU General Public License
#     as published by the Free Software Foundation; either version 2 of
#     the License, or (at your option) any later version.
#
#     The Code_Saturne Kernel is distributed in the hope that it will be
#     useful, but WITHOUT ANY WARRANTY; without even the implied warranty
#     of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#     GNU General Public License for more details.
#
#     You should have received a copy of the GNU General Public License
#     along with the Code_Saturne Kernel; if not, write to the
#     Free Software Foundation, Inc.,
#     51 Franklin St, Fifth Floor,
#     Boston, MA  02110-1301  USA
#
#============================================================================
#
#=================================================
#     Code_Saturne help
#=================================================
#

#
# Styles
# ======

 TERM=$TERM

 BO=`tput bold`
 SO=`tput smso`
 NO=`tput rmso ; tput sgr0`

#
# Function: exit
# ==============

 local_exit()
 {
   tput rmso
   tput init
   exit
 }

#
# Function: error message with exit
# =================================

 sortie()
 {
   dir_sortie=`pwd`
   echo "   Directory: ${dir_sortie}"
   echo
   echo "   ${BO}Error${NO}: $*"
   tput init
   echo
   local_exit
 }


#
# Function: usage
# ===============

 usage() {
    echo
    echo "   usage: ${BO}cs_info${NO}                      "
    echo "      or: ${BO}cs_info${NO}  ${SO}<topic>${NO}   "
    echo
    echo "        with:                                    "
    echo "        ${SO}<topic>${NO}: ${BO}version${NO}   : Code_Saturne version"
    echo "                  ${BO}user${NO}       : user manual (pdf)"
    echo "                  ${BO}theory${NO}     : theory and programmer's guide (pdf)"
    echo "                  ${BO}tutorial${NO}   : Code_Saturne tutorial (pdf)"
    echo "                  ${BO}ecs_user${NO}   : user and theory manual for the Preprocessor module (pdf)"
    echo "                  ${BO}cs${NO}         : usage for the Kernel module"
    echo "                  ${BO}ecs${NO}        : usage for the Preprocessor module"
    echo "                  ${BO}check_mesh${NO} : usage of mesh checking script"
    echo "                  ${BO}gracehst${NO}   : usage of xmgrace launch script gracehst"
    echo
    echo
    tput init
    local_exit
 }


 if [ -z "$CS_HOME" ]; then
   echo
   echo " ${BO}WARNING${NO} : variable CS_HOME is not properly set"
   echo "             Depending on the environment, it is possible to specify"
   echo "             it in the .monprofile file."
   echo "             Remember to logout and login again afterwards."
   echo
   tput init
   local_exit
 fi

# Test if xpdf or acroread exists
isthere=`which xpdf 2>/dev/null |wc -w`
if [ $isthere -eq 1 ] ; then
  acroread=xpdf
else
  acroread=acroread
fi

docPATH=$CS_HOME/arch/$NOM_ARCH/share/doc

 topic=$1
 if   [ "$topic" = "version" ] ; then
   whichINFOCS=`which cs_info`
   varPATH=$whichINFOCS
   varPATH=`dirname  $varPATH`
   varPATH=`dirname  $varPATH`
   version=$varPATH
   if [ "$CS_HOME" != "$version" ] ; then
     echo
     echo " ${BO}WARNING${NO}               : variable CS_HOME and the UNIX PATH"
     echo "                             do not seem consistent :"
     echo "        ${BO}CS_HOME variable     ${NO} : $CS_HOME"
     echo "        ${BO}Path of cs_info      ${NO} : $whichINFOCS"
     echo
     echo " ${BO}Restart the session of necessary${NO}"
     echo
     tput init
   else
     echo
     echo " ${BO}Code_Saturne version${NO} : $version"
     echo " ${BO}Preprocessor version${NO} : $CSPP_HOME"
     echo " ${BO}GUI version${NO}          : $CSGUI_HOME"
     echo
     tput init
  fi
 elif [ "$topic" = "user" ] ; then
   [ -d $docPATH ] || sortie "The documentation directory $docPATH does not exist"
   saturnepdf=$docPATH/user.pdf
   echo
   echo " ${BO}user manual${NO} : $saturnepdf"
   echo
   tput init
   $acroread $saturnepdf  || sortie "The ${SO}$acroread $saturnepdf${NO} command failed"
   tput init
 elif [ "$topic" = "theory" ] ; then
   [ -d $docPATH ] || sortie "The documentation directory $docPATH does not exist"
   noyaupdf=$docPATH/theory.pdf
   echo
   echo " ${BO}theory and programmer's guide${NO} : $noyaupdf"
   echo
   $acroread $noyaupdf
 elif [ "$topic" = "tutorial" ] ; then
   [ -d $docPATH ] || sortie "The documentation directory $docPATH does not exist"
   noyaupdf=$docPATH/tutorial.pdf
   echo
   echo " ${BO}Code_Saturne tutorial${NO} : $noyaupdf"
   echo
   $acroread $noyaupdf
 elif [ "$topic" = "cs" ] ; then
   cs=$CS_HOME/bin/cs.exe
   echo
   echo " ${BO}Kernel module usage${NO}"
   echo
   tput init
   eval $cs -h || sortie "The ${SO}$cs -h${NO} command failed."
   echo
   echo " ${BO}Kernel module usage${NO}"
   echo
   tput init
 elif [ "$topic" = "ecs" ] ; then
   ecs=$CSPP_HOME/arch/$NOM_ARCH/bin/ecs
   echo
   echo " ${BO}Preprocessor module${NO} : use ecs or $ecs"
   echo
   tput init
   eval $ecs -h || sortie "The ${SO}$ecs -h${NO} command failed."
   echo
   echo " ${BO}Preprocessor module${NO} : use ecs or $ecs"
   echo
   tput init
 elif [ "$topic" = "ecs_user" ] ; then
   ecsdocpdf=$CSPP_HOME/doc/mu_ecs.pdf
   echo
   echo " ${BO}Preprocessor module user manual${NO} : $ecsdocpdf"
   echo
   tput init
   $acroread $ecsdocpdf || sortie "The ${SO}$acroread $ecsdocpdf${NO} command failed"
   tput init
 elif [ "$topic" = "check_mesh" ] ; then
   check_mesh=$CS_HOME/bin/check_mesh
   echo
   echo " ${BO}mesh verification and quality with ${NO} : $check_mesh"
   echo
   tput init
   $check_mesh -h || sortie "The $check_mesh -h command failed"
   tput init ; tput rmso
 elif [ "$topic" = "gracehst" ] ; then
   gracehst=$CS_HOME/bin/gracehst
   echo
   echo " ${BO}xmgrace launch script${NO} : $gracehst"
   echo
   tput init
   $gracehst -h || sortie "The $gracehst -h command failed"
   tput init ; tput rmso
else
  usage
 fi
